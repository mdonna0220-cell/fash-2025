<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æœé¥°è®¾è®¡åŠ©æ‰‹ (å®‰å…¨åå°ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        .container { max-width: 960px; position: relative; }
        .btn { transition: all 0.2s ease; }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { transform: none; cursor: not-allowed; opacity: 0.7; }
        #image-container img, #detail-image-container img, #uploaded-image-preview, #i2i-generated-image, #lineart-upload-generated-image, #bg-generated-image { max-width: 100%; height: auto; border-radius: 0.75rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .modal { background-color: rgba(0, 0, 0, 0.5); }
        #notebook-toggle, #encyclopedia-toggle { position: absolute; top: 1rem; z-index: 20; }
        #notebook-toggle { right: 1rem; }
        #encyclopedia-toggle { left: 1rem; }
        .upload-zone { border: 2px dashed #cbd5e1; transition: all 0.2s ease; }
        .upload-zone:hover { border-color: #8b5cf6; background-color: #f5f3ff; }
        .upload-zone.has-image { border-color: #10b981; }
        .spinner { display: inline-block; animation: spin 1s linear infinite; border-radius: 50%; width: 2rem; height: 2rem; border-width: 4px; border-color: #d1d5db; border-top-color: #4f46e5; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #notebook-panel { position: absolute; top: 4.5rem; right: 1rem; }
        #notebook-header { cursor: move; }
        #auth-modal-overlay { background-color: rgba(0, 0, 0, 0.75); }
        #app-container.blurred { filter: blur(5px); pointer-events: none; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div id="auth-modal-overlay" class="fixed inset-0 z-40 bg-gray-900 bg-opacity-75"></div>
    <div id="auth-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white p-8 rounded-lg shadow-2xl w-full max-w-sm z-50">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">æ¬¢è¿ä½¿ç”¨</h2>
        <div class="space-y-4">
            <div>
                <label for="phone-input" class="block text-sm font-medium text-gray-700">æ‰‹æœºå·ç </label>
                <input type="tel" id="phone-input" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="è¯·è¾“å…¥æ‰‹æœºå·">
            </div>
            <div class="flex items-end space-x-2">
                <div class="flex-grow">
                    <label for="code-input" class="block text-sm font-medium text-gray-700">éªŒè¯ç </label>
                    <input type="text" id="code-input" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="è¯·è¾“å…¥4ä½éªŒè¯ç ">
                </div>
                <button id="send-code-btn" class="flex-shrink-0 px-4 py-2 bg-gray-600 text-white font-semibold rounded-md hover:bg-gray-700 disabled:bg-gray-400">å‘é€éªŒè¯ç </button>
            </div>
            <p id="auth-error-msg" class="text-sm text-red-600 text-center h-4"></p>
            <button id="login-btn" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-full shadow-lg hover:bg-indigo-700 disabled:bg-indigo-400">
                ç™»å½• / æ³¨å†Œ
            </button>
        </div>
    </div>

    <div id="app-container" class="container mx-auto bg-white p-8 rounded-2xl shadow-2xl space-y-8 blurred">
        <div id="notebook-toggle" class="absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 cursor-pointer" title="çµæ„Ÿç¬”è®°æœ¬">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
        </div>
        <div id="encyclopedia-toggle" class="absolute top-4 left-4 p-2 rounded-full hover:bg-gray-100 cursor-pointer" title="æ—¶å°šç™¾ç§‘å…¨ä¹¦">
             <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-8.494h18m-18 5.494h18M5 21h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
        </div>
        <div id="notebook-panel" class="hidden w-72 bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-lg z-30">
            <div id="notebook-header" class="flex justify-between items-center pb-2 mb-2 border-b border-gray-200">
                <h3 class="text-lg font-bold text-gray-800">çµæ„Ÿç¬”è®°æœ¬</h3>
                 <span class="text-gray-400" title="å¯æ‹–åŠ¨">âœ¥</span>
            </div>
            <textarea id="notebook-textarea" class="w-full h-48 p-2 border border-gray-200 rounded-md resize-none focus:ring-2 focus:ring-purple-400" placeholder="åœ¨è¿™é‡Œè®°å½•ä½ çš„çµæ„Ÿå…³é”®è¯..."></textarea>
            <div class="flex justify-between items-center mt-2">
                <span id="notebook-status" class="text-sm text-green-600 opacity-0 transition-opacity">å·²ä¿å­˜!</span>
                <div>
                    <button id="notebook-copy-btn" class="px-3 py-1 text-sm font-semibold text-white bg-gray-600 hover:bg-gray-700 rounded-full btn">å¤åˆ¶</button>
                    <button id="notebook-clear-btn" class="px-3 py-1 text-sm font-semibold text-white bg-red-600 hover:bg-red-700 rounded-full btn">æ¸…ç©º</button>
                </div>
            </div>
        </div>
        <div id="main-page">
            <header class="text-center">
                <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800">AI æœé¥°è®¾è®¡åŠ©æ‰‹ ğŸ‘•</h1>
                <p class="mt-2 text-gray-600">è¾“å…¥ä½ çš„æœè£…è®¾è®¡æƒ³æ³•ï¼Œç”Ÿæˆä¸“ä¸šçš„è®¾è®¡å›¾å’Œè¯´æ˜ã€‚</p>
                <p class="mt-2 text-sm text-gray-500">ä»Šæ—¥å‰©ä½™æ¬¡æ•°: <span id="api-usage-counter">--</span></p>
            </header>
            <div class="text-center">
                <button id="go-to-i2i" class="inline-block px-6 py-2 text-white font-bold rounded-full shadow-lg bg-cyan-600 hover:bg-cyan-700">åˆ‡æ¢åˆ°å›¾ç”Ÿå›¾æ¨¡å¼ â†’</button>
            </div>
            <main class="space-y-4">
                <div>
                    <label for="prompt-input" class="block text-sm font-medium text-gray-700">è¾“å…¥ä½ çš„æœè£…è®¾è®¡æƒ³æ³•ï¼š</label>
                    <textarea id="prompt-input" rows="4" class="mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500 transition-colors" placeholder="ä¾‹å¦‚: ä¸€ä»¶èµ›åšæœ‹å…‹é£æ ¼çš„æœªæ¥æ´¾å¤¹å…‹ï¼Œå¸¦æœ‰éœ“è™¹ç¯å¸¦ï¼Œç”±åå…‰é¢æ–™åˆ¶æˆ"></textarea>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-5 gap-3">
                    <button id="refine-btn" class="min-w-0 w-full px-4 py-3 border border-transparent rounded-full shadow-lg text-sm sm:text-base font-bold text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"><span>çµæ„Ÿè¯åº“ ğŸ“š</span></button>
                    <button id="scripting-btn" class="min-w-0 w-full px-4 py-3 border border-transparent rounded-full shadow-lg text-sm sm:text-base font-bold text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"><span>åœºæ™¯æ­é… ğŸ­</span></button>
                    <div class="relative min-w-0">
                        <button id="generate-model-btn" class="w-full px-4 py-3 border border-transparent rounded-full shadow-lg text-sm sm:text-base font-bold text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"><span>ç”Ÿæˆæ¨¡ç‰¹ ğŸ§</span></button>
                        <div id="model-options" class="absolute top-full mt-2 w-56 bg-white rounded-md shadow-lg z-10 hidden origin-top-right right-0">
                            <div class="py-1">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-model-style="sketch">æ‰‹ç»˜é£æ ¼</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-model-style="photo">AIæ‘„å½±å¸ˆ (çœŸå®æ•ˆæœ)</a>
                            </div>
                        </div>
                    </div>
                    <button id="generate-btn" class="min-w-0 w-full px-4 py-3 border border-transparent rounded-full shadow-lg text-sm sm:text-base font-bold text-white bg-orange-500 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500" disabled><span>ç”Ÿæˆè®¾è®¡å›¾ âœ¨</span></button>
                    <button id="lineart-btn" class="min-w-0 w-full px-4 py-3 border border-transparent rounded-full shadow-lg text-sm sm:text-base font-bold text-white bg-purple-500 hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500"><span>è®¾è®¡çº¿ç¨¿ âœ’ï¸</span></button>
                </div>
                <section id="result-container" class="space-y-4">
                    <div id="main-loading-container" class="text-center py-8 hidden"><div class="spinner"></div><p class="mt-2 text-sm font-medium text-gray-600">æ­£åœ¨åŠ è½½...</p></div>
                    <div id="image-container" class="w-full h-auto flex justify-center items-center relative"><img id="generated-image" class="hidden" alt="Generated AI Image"></div>
                    <div id="model-modification-container" class="hidden text-center mt-4 space-y-3">
                        <button id="show-modify-model-input-btn" class="px-6 py-2 text-white font-bold rounded-full shadow-lg bg-cyan-600 hover:bg-cyan-700">ä¿®æ”¹æ¨¡ç‰¹å›¾ ğŸ¨</button>
                        <div id="modify-model-input-area" class="hidden w-full max-w-lg mx-auto space-y-2">
                            <textarea id="modify-model-prompt" rows="2" class="w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="ä¾‹å¦‚ï¼šç»™æ¨¡ç‰¹æ¢ä¸Šçº¢è‰²é•¿å‘ï¼Œç©¿ä¸Šçš®å¤¹å…‹"></textarea>
                            <button id="submit-model-modification-btn" class="w-full sm:w-auto px-6 py-2 text-white font-bold rounded-full shadow-lg bg-emerald-500 hover:bg-emerald-600">ç”Ÿæˆä¿®æ”¹å›¾</button>
                        </div>
                    </div>
                    <div id="detail-image-container" class="w-full h-auto flex justify-center items-center mt-4"><div class="relative w-full"><div id="detail-loading-container" class="text-center py-8 hidden"><div class="spinner"></div><p class="mt-2 text-sm font-medium text-gray-600">æ­£åœ¨ç”Ÿæˆä¿®æ”¹å›¾...</p></div><img id="detail-image" class="hidden mx-auto" alt="Detailed AI Image"></div></div>
                    <div id="story-buttons-container" class="flex flex-col space-y-2 mt-4 hidden">
                        <label for="story-prompt-input" class="block text-sm font-medium text-gray-700">è®¾è®¡è¯´æ˜æŒ‡ä»¤ (å¯ç¼–è¾‘)ï¼š</label>
                        <textarea id="story-prompt-input" rows="2" class="w-full rounded-lg border border-gray-300 shadow-sm p-3 story-prompt-textarea focus:border-indigo-500 focus:ring-indigo-500 transition-colors"></textarea>
                        <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-2 mt-4 relative">
                            <button id="story-btn" class="w-full sm:w-auto px-6 py-3 border border-transparent rounded-full shadow-lg text-base sm:text-lg font-bold text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" disabled><span>ç”Ÿæˆè®¾è®¡è¯´æ˜ âœ¨</span></button>
                            <button id="detail-btn" class="w-full sm:w-auto px-6 py-3 border border-transparent rounded-full shadow-lg text-base sm:text-lg font-bold text-white bg-emerald-500 hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" disabled><span>æ·±åŒ–è®¾è®¡ç»†èŠ‚ ğŸ”¬</span></button>
                            <div id="detail-options" class="absolute top-full mt-2 w-full sm:w-auto bg-white rounded-md shadow-lg z-10 hidden">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 font-bold" data-detail-prompt="custom">æ›´å¤šç»†èŠ‚... (æ‰‹åŠ¨è¾“å…¥)</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-detail-prompt="Show a macro close-up of the fabric texture.">æ”¾å¤§é¢æ–™ç»†èŠ‚</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-detail-prompt="Show the back view of this garment.">å±•ç¤ºæœè£…èƒŒé¢</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-detail-prompt="Show the side profile of this garment.">å±•ç¤ºæœè£…ä¾§é¢</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-detail-prompt="show-on-model">å±•ç¤ºæ¨¡ç‰¹ä¸Šèº«æ•ˆæœ</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-detail-prompt="Show this garment flat lay.">å±•ç¤ºæœè£…å¹³é“ºå›¾</a>
                            </div>
                        </div>
                    </div>
                    <div id="story-container" class="p-4 bg-gray-50 border border-dashed border-gray-300 rounded-lg hidden">
                        <p class="text-sm font-medium text-gray-700">è®¾è®¡è¯´æ˜ï¼š</p>
                        <p id="story-text" class="mt-1 text-gray-900 leading-relaxed whitespace-pre-wrap"></p>
                        <div id="story-action-buttons" class="flex justify-center mt-4 hidden"><button id="copy-story-btn" class="px-6 py-2 text-sm font-bold text-white rounded-full shadow-lg bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">ä¸€é”®å¤åˆ¶</button></div>
                    </div>
                    <div id="error-message" class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg hidden"><p id="error-text" class="text-sm font-medium"></p></div>
                </section>
            </main>
        </div>
        <div id="i2i-page" class="hidden">
            <header class="text-center">
                <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800">å›¾ç”Ÿå›¾å·¥ä½œå®¤ ğŸ–¼ï¸</h1>
                <p class="mt-2 text-gray-600">ä¸Šä¼ æ¨¡ç‰¹ä¸æœè£…ï¼Œä¸€é”®ç”Ÿæˆç©¿æ­æ•ˆæœå›¾ã€‚</p>
            </header>
            <div class="text-center mt-4"><button id="go-to-main" class="inline-block px-6 py-2 text-white font-bold rounded-full shadow-lg bg-gray-600 hover:bg-gray-700">â† è¿”å›æ–‡æœ¬åˆ›ä½œæ¨¡å¼</button></div>
            <section id="image-to-image-section" class="space-y-6 pt-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="w-full">
                        <p class="text-center font-semibold text-gray-700 mb-2">1. ä¸Šä¼ æ¨¡ç‰¹å›¾</p>
                        <label for="i2i-model-upload-input" class="block text-center p-6 rounded-lg cursor-pointer upload-zone"><svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mt-2 block text-sm font-medium text-gray-600">ç‚¹å‡»ä¸Šä¼ æ¨¡ç‰¹</span></label>
                        <input type="file" id="i2i-model-upload-input" class="hidden" accept="image/*">
                        <div id="i2i-model-preview-container" class="hidden text-center mt-4"><img id="i2i-model-preview" class="mx-auto" style="max-height: 200px; width: auto;" alt="Model Preview"></div>
                    </div>
                    <div class="w-full">
                        <p class="text-center font-semibold text-gray-700 mb-2">2. ä¸Šä¼ æœè£…å›¾</p>
                        <label for="i2i-garment-upload-input" class="block text-center p-6 rounded-lg cursor-pointer upload-zone"><svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mt-2 block text-sm font-medium text-gray-600">ç‚¹å‡»ä¸Šä¼ æœè£…</span></label>
                        <input type="file" id="i2i-garment-upload-input" class="hidden" accept="image/*">
                        <div id="i2i-garment-preview-container" class="hidden text-center mt-4"><img id="i2i-garment-preview" class="mx-auto" style="max-height: 200px; width: auto;" alt="Garment Preview"></div>
                    </div>
                </div>
                <div class="w-full max-w-md mx-auto space-y-4">
                    <button id="try-on-btn" class="w-full py-3 px-4 border border-transparent rounded-full shadow-lg text-base font-bold text-white bg-emerald-500 hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" disabled>ä¸€é”®ç©¿æ­ ğŸ‘•</button>
                    <div id="i2i-generated-image-container" class="hidden text-center">
                        <div class="space-y-6">
                            <div id="i2i-before-container" class="hidden w-full relative"><img id="i2i-before-image" class="mx-auto rounded-lg shadow-md" alt="Original Try-on Image"></div>
                            <div id="i2i-after-container" class="w-full relative"><div id="i2i-loading-container" class="text-center py-8 hidden"><div class="spinner"></div><p class="mt-2 text-sm font-medium text-gray-600">æ­£åœ¨åŠ è½½...</p></div><img id="i2i-generated-image" class="mx-auto rounded-lg shadow-md" alt="Generated Image"></div>
                            <div id="i2i-modification-buttons" class="w-full flex flex-col items-center gap-2">
                                <button id="modify-try-on-btn" class="hidden w-full sm:w-auto px-6 py-3 border border-transparent rounded-full shadow-lg text-base font-bold text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500"><span>ä¿®æ”¹æ•ˆæœå›¾ ğŸ¨</span></button>
                                <button id="generate-copy-btn" class="hidden w-full sm:w-auto px-6 py-3 border border-transparent rounded-full shadow-lg text-base font-bold text-white bg-purple-500 hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500"><span>ç”Ÿæˆæ–‡æ¡ˆ âœï¸</span></button>
                            </div>
                            <div id="copy-display-container" class="hidden p-4 bg-gray-50 border border-dashed border-gray-300 rounded-lg text-left"><div class="flex justify-between items-center mb-2"><p class="text-sm font-medium text-gray-700">ç”Ÿæˆæ–‡æ¡ˆï¼š</p><button id="copy-generated-text-btn" class="px-3 py-1 text-sm font-semibold text-white rounded-full bg-gray-600 hover:bg-gray-700">å¤åˆ¶</button></div><p id="generated-copy-text" class="mt-1 text-gray-900 leading-relaxed whitespace-pre-wrap"></p></div>
                        </div>
                    </div>
                </div>
            </section>
            <hr class="my-8 border-t border-gray-200">
            <section id="background-replacement-section" class="space-y-6 pt-2">
                <header class="text-center">
                    <h2 class="text-2xl font-bold text-gray-800">äº§å“èƒŒæ™¯æ›´æ¢å·¥ä½œå®¤ ğŸï¸</h2>
                    <p class="mt-1 text-gray-500">ä¸Šä¼ äº§å“å›¾å’Œæ–°èƒŒæ™¯ï¼Œä¸€é”®åˆæˆè¥é”€å›¾ã€‚</p>
                </header>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="w-full">
                        <p class="text-center font-semibold text-gray-700 mb-2">1. ä¸Šä¼ äº§å“å›¾</p>
                        <label for="bg-garment-upload-input" class="block text-center p-6 rounded-lg cursor-pointer upload-zone"><svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mt-2 block text-sm font-medium text-gray-600">ç‚¹å‡»ä¸Šä¼ äº§å“</span></label>
                        <input type="file" id="bg-garment-upload-input" class="hidden" accept="image/*">
                        <div id="bg-garment-preview-container" class="hidden text-center mt-4"><img id="bg-garment-preview" class="mx-auto" style="max-height: 200px; width: auto;" alt="Product Preview"></div>
                    </div>
                    <div class="w-full">
                        <p class="text-center font-semibold text-gray-700 mb-2">2. ä¸Šä¼ èƒŒæ™¯å›¾</p>
                        <label for="bg-background-upload-input" class="block text-center p-6 rounded-lg cursor-pointer upload-zone"><svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mt-2 block text-sm font-medium text-gray-600">ç‚¹å‡»ä¸Šä¼ èƒŒæ™¯</span></label>
                        <input type="file" id="bg-background-upload-input" class="hidden" accept="image/*">
                        <div id="bg-background-preview-container" class="hidden text-center mt-4"><img id="bg-background-preview" class="mx-auto" style="max-height: 200px; width: auto;" alt="Background Preview"></div>
                    </div>
                </div>
                <div class="w-full max-w-md mx-auto space-y-4">
                    <button id="change-bg-btn" class="w-full py-3 px-4 border border-transparent rounded-full shadow-lg text-base font-bold text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500" disabled>æ›´æ¢èƒŒæ™¯ ğŸ–¼ï¸</button>
                    <div id="bg-generated-image-container" class="hidden text-center"><div class="space-y-6"><div id="bg-after-container" class="w-full relative"><div id="bg-loading-container" class="text-center py-8 hidden"><div class="spinner"></div><p class="mt-2 text-sm font-medium text-gray-600">æ­£åœ¨åŠ è½½...</p></div><img id="bg-generated-image" class="mx-auto rounded-lg shadow-md" alt="Generated Image with New Background"></div></div></div>
                </div>
            </section>
        </div>
        <div id="vocab-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-2xl bg-white space-y-6"><div class="flex justify-between items-center pb-3"><h3 class="text-2xl font-bold text-gray-900">æœé¥°è®¾è®¡çµæ„Ÿè¯åº“</h3><button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">Ã—</button></div><div class="space-y-4"><h4 class="text-lg font-semibold text-gray-700 cursor-pointer hover:text-indigo-600 transition-colors" data-target="style-type-buttons">æ¬¾å¼ç±»åˆ« (Garment Type)</h4><div id="style-type-buttons" class="flex flex-wrap gap-2 hidden"></div></div><div class="space-y-4"><h4 class="text-lg font-semibold text-gray-700 cursor-pointer hover:text-indigo-600 transition-colors" data-target="aesthetic-buttons">è®¾è®¡é£æ ¼ (Aesthetic)</h4><div id="aesthetic-buttons" class="flex flex-wrap gap-2 hidden"></div></div><div class="space-y-4"><h4 class="text-lg font-semibold text-gray-700 cursor-pointer hover:text-indigo-600 transition-colors" data-target="material-buttons">é¢æ–™æè´¨ (Material)</h4><div id="material-buttons" class="flex flex-wrap gap-2 hidden"></div></div><div class="space-y-4"><h4 class="text-lg font-semibold text-gray-700 cursor-pointer hover:text-indigo-600 transition-colors" data-target="pattern-buttons">å›¾æ¡ˆå°èŠ± (Pattern/Print)</h4><div id="pattern-buttons" class="flex flex-wrap gap-2 hidden"></div></div><div class="space-y-4"><h4 class="text-lg font-semibold text-gray-700 cursor-pointer hover:text-indigo-600 transition-colors" data-target="details-buttons">ç»†èŠ‚å‰ªè£ (Details/Cut)</h4><div id="details-buttons" class="flex flex-wrap gap-2 hidden"></div></div><div class="space-y-4"><h4 class="text-lg font-semibold text-gray-700 cursor-pointer hover:text-indigo-600 transition-colors" data-target="color-buttons">è‰²å½©æ­é… (Color)</h4><div id="color-buttons" class="flex flex-wrap gap-2 hidden"></div></div></div></div>
        <div id="custom-detail-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-2xl bg-white space-y-4"><div class="flex justify-between items-center"><h3 class="text-xl font-bold text-gray-900">è¾“å…¥è‡ªå®šä¹‰ä¿®æ”¹æŒ‡ä»¤</h3><button id="close-custom-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">Ã—</button></div><div><textarea id="custom-detail-input" rows="3" class="w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="ä¾‹å¦‚ï¼šç»™è¿™ä»¶å¤¹å…‹åŠ ä¸Šå…œå¸½"></textarea></div><div class="flex justify-end"><button id="submit-custom-detail" class="px-6 py-2 text-white font-bold rounded-full shadow-lg bg-emerald-500 hover:bg-emerald-600">ç”Ÿæˆç»†èŠ‚å›¾</button></div></div></div>
        <div id="custom-model-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-2xl bg-white space-y-4"><div class="flex justify-between items-center"><h3 id="custom-model-title" class="text-xl font-bold text-gray-900">è¾“å…¥è‡ªå®šä¹‰æ¨¡ç‰¹ç‰¹å¾</h3><button id="close-custom-model-btn" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">Ã—</button></div><div><textarea id="custom-model-input" rows="3" class="w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="ä¾‹å¦‚ï¼š25å²äºšæ´²ç”·æ€§ï¼Œèº«æå¥ç¡•ï¼Œæ·±è‰²çš®è‚¤ï¼Œèº«é«˜185cmï¼Œå†™å®ç…§ç‰‡é£æ ¼"></textarea></div><div class="flex justify-end"><button id="submit-custom-model" class="px-6 py-2 text-white font-bold rounded-full shadow-lg bg-indigo-600 hover:bg-indigo-700">ç”Ÿæˆæ¨¡ç‰¹</button></div></div></div>
        <div id="modify-try-on-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-2xl bg-white space-y-4"><div class="flex justify-between items-center"><h3 class="text-xl font-bold text-gray-900">è¾“å…¥ä¿®æ”¹æŒ‡ä»¤</h3><button id="close-modify-try-on-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">Ã—</button></div><div><textarea id="modify-try-on-input" rows="3" class="w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="ä¾‹å¦‚ï¼šå°†èƒŒæ™¯æ¢æˆè¡—é“ï¼Œå±•ç¤ºä¾§é¢æ•ˆæœ"></textarea></div><div class="flex justify-end"><button id="submit-modify-try-on" class="px-6 py-2 text-white font-bold rounded-full shadow-lg bg-cyan-600 hover:bg-cyan-700">ç¡®è®¤ä¿®æ”¹</button></div></div></div>
        <div id="generate-copy-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-2xl bg-white space-y-4"><div class="flex justify-between items-center"><h3 class="text-xl font-bold text-gray-900">ç”Ÿæˆæ¨å¹¿æ–‡æ¡ˆ</h3><button id="close-generate-copy-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">Ã—</button></div><div><label for="generate-copy-input" class="block text-sm font-medium text-gray-700 mb-1">æ–‡æ¡ˆè¦æ±‚ (é€‰å¡«)</label><textarea id="generate-copy-input" rows="3" class="w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="ä¾‹å¦‚ï¼šå°çº¢ä¹¦é£æ ¼ï¼Œçªå‡ºå°‘å¥³æ„Ÿå’Œå¤æ—¥æ¸…å‡‰"></textarea></div><div class="flex justify-end"><button id="submit-generate-copy" class="px-6 py-2 text-white font-bold rounded-full shadow-lg bg-purple-500 hover:bg-purple-600">ç”Ÿæˆæ–‡æ¡ˆ</button></div></div></div>
        <div id="i2i-custom-detail-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-2xl bg-white space-y-4"><div class="flex justify-between items-center"><h3 class="text-xl font-bold text-gray-900">è¾“å…¥è‡ªå®šä¹‰ä¿®æ”¹æŒ‡ä»¤</h3><button id="i2i-close-custom-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">Ã—</button></div><div><textarea id="i2i-custom-detail-input" rows="3" class="w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="ä¾‹å¦‚ï¼šæŠŠè¿™ä»¶Tæ¤çš„é¢œè‰²æ”¹æˆé»‘è‰²"></textarea></div><div class="flex justify-end"><button id="i2i-submit-custom-detail" class="px-6 py-2 text-white font-bold rounded-full shadow-lg bg-emerald-500 hover:bg-emerald-600">ç”Ÿæˆç»†èŠ‚å›¾</button></div></div></div>
        <div id="lineart-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-2/3 shadow-lg rounded-2xl bg-white space-y-4 max-h-[90vh] overflow-y-auto"><div class="flex justify-between items-center"><h3 class="text-2xl font-bold text-gray-900">è®¾è®¡çº¿ç¨¿ç”Ÿæˆå™¨ âœ’ï¸</h3><button id="close-lineart-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">Ã—</button></div><div class="p-4 border-b border-gray-200"><h4 class="text-xl font-semibold mb-2 text-center">ä»æ–‡æœ¬ç”Ÿæˆçº¿ç¨¿</h4><div class="flex space-x-2"><input type="text" id="lineart-input" class="flex-grow rounded-full border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="è¾“å…¥è®¾è®¡ä¸»é¢˜ï¼Œä¾‹å¦‚ï¼šä¸€ä»¶è¿è¡£è£™"><button id="lineart-generate-btn" class="px-6 py-2 text-white font-bold rounded-full shadow-lg bg-purple-500 hover:bg-purple-600">ç”Ÿæˆçº¿ç¨¿</button></div></div><div id="lineart-loading-container" class="text-center py-8 hidden"><div class="spinner"></div><p class="mt-2 text-sm font-medium text-gray-600">æ­£åœ¨ç”Ÿæˆçº¿ç¨¿...</p></div><div id="lineart-results" class="space-y-4 p-2 text-center"></div><hr class="my-4"><div class="p-4"><h4 class="text-xl font-semibold mb-2 text-center">ä¸Šä¼ å›¾ç‰‡å†åˆ›ä½œ</h4><div class="w-full max-w-md mx-auto"><label for="lineart-upload-input" class="block text-center p-6 rounded-lg cursor-pointer upload-zone"><svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mt-2 block text-sm font-medium text-gray-600">ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</span></label><input type="file" id="lineart-upload-input" class="hidden" accept="image/*"><div id="lineart-upload-preview-container" class="hidden text-center mt-4"><img id="lineart-upload-preview" class="mx-auto rounded-lg shadow-md" alt="Uploaded Image Preview"></div><div id="lineart-upload-modification-container" class="hidden w-full max-w-md mx-auto mt-4 space-y-3"><label for="lineart-upload-modification-prompt" class="block text-sm font-medium text-gray-700">å¯åœ¨æ­¤å¤„æè¿°æœŸæœ›çš„çœŸäººæ¨¡ç‰¹ç‰¹å¾ (é€‰å¡«):</label><textarea id="lineart-upload-modification-prompt" rows="3" class="w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="ä¾‹å¦‚ï¼šæ¢æˆäºšæ´²æ¨¡ç‰¹ã€èƒŒæ™¯åœ¨ä¸œäº¬è¡—å¤´ã€æ”¹ä¸ºçŸ­å‘ç­‰"></textarea><button id="lineart-upload-modify-btn" class="w-full py-2 px-4 border border-transparent rounded-full shadow-lg text-base font-bold text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500">åˆ›æ„ä¿®æ”¹</button><button id="illustration-to-photo-btn" class="w-full py-3 px-4 border border-transparent rounded-full shadow-lg text-base font-bold text-white bg-emerald-500 hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"><span class="flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path></svg>ä¸€é”®è½¬ä¸ºçœŸäººæ•ˆæœ</span></button></div><div id="lineart-upload-loading-container" class="text-center py-8 hidden"><div class="spinner"></div><p class="mt-2 text-sm font-medium text-gray-600">æ­£åœ¨ç”Ÿæˆæ–°å›¾ç‰‡...</p></div><div id="lineart-upload-generated-image-container" class="hidden text-center mt-6 relative"><img id="lineart-upload-generated-image" class="mx-auto rounded-lg shadow-md" alt="Generated Image from Upload"></div></div></div></div></div>
        <div id="lineart-custom-detail-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-2xl bg-white space-y-4"><div class="flex justify-between items-center"><h3 class="text-xl font-bold text-gray-900">è¾“å…¥è‡ªå®šä¹‰ä¿®æ”¹æŒ‡ä»¤</h3><button id="lineart-close-custom-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">Ã—</button></div><div><textarea id="lineart-custom-detail-input" rows="3" class="w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="ä¾‹å¦‚ï¼šç»™è¿™ä»¶è¡£æœä¸Šè‰²"></textarea></div><div class="flex justify-end"><button id="lineart-submit-custom-detail" class="px-6 py-2 text-white font-bold rounded-full shadow-lg bg-emerald-500 hover:bg-emerald-600">ç”Ÿæˆ</button></div></div></div>
        <div id="encyclopedia-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-2/3 shadow-lg rounded-2xl bg-white space-y-4"><div class="flex justify-between items-center"><h3 class="text-2xl font-bold text-gray-900">æ—¶å°šç™¾ç§‘å…¨ä¹¦ ğŸ“–</h3><button id="close-encyclopedia-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">Ã—</button></div><div class="flex space-x-2"><input type="text" id="encyclopedia-input" class="flex-grow rounded-full border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="è¾“å…¥å…³é”®è¯æœç´¢ï¼Œä¾‹å¦‚ï¼šé¦™å¥ˆå„¿"><button id="encyclopedia-search-btn" class="px-6 py-2 text-white font-bold rounded-full shadow-lg bg-indigo-600 hover:bg-indigo-700">æœç´¢</button></div><div id="encyclopedia-loading" class="text-center py-4 hidden"><div class="spinner"></div><p class="mt-2 text-sm font-medium text-blue-600">æ­£åœ¨æ£€ç´¢ä¿¡æ¯åº“...</p></div><div id="encyclopedia-results" class="space-y-4 max-h-[60vh] overflow-y-auto p-2"></div></div></div>
        <div id="scripting-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-2/3 shadow-lg rounded-2xl bg-white space-y-4 max-h-[90vh] overflow-y-auto"><div class="flex justify-between items-center"><h3 class="text-2xl font-bold text-gray-900">åœºæ™¯æœè£…æ­é…åŠ©æ‰‹ ğŸ­</h3><button id="close-scripting-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">Ã—</button></div><div class="p-4 border-b border-gray-200 space-y-4"><div><label for="script-input" class="block text-sm font-medium text-gray-700">è¾“å…¥åœºæ™¯ã€æ°›å›´æˆ–äººç‰©é£æ ¼ï¼š</label><textarea id="script-input" rows="6" class="mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500 transition-colors" placeholder="ä¾‹å¦‚ï¼šåœ¨ä¸‹é›¨çš„ä¸œäº¬è¡—å¤´ï¼Œä¸€ä¸ªå­¤ç‹¬çš„å¥³å­©..."></textarea></div><div class="space-y-2"><p class="text-sm font-medium text-gray-600">é€‰æ‹©ä¸€ç§é£æ ¼å¿«é€Ÿå¼€å§‹ï¼š</p><div id="default-style-buttons" class="flex flex-wrap gap-2"><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors" data-style="ç›ç³»ï¼šæ¸…æ·¡ã€ç®€çº¦ã€ä¸­æ€§çš„ç‰¹ç‚¹ã€‚éšæ€§è€Œä¸éšä¾¿çš„èˆ’é€‚æ„Ÿ ï¼Œå…¶ä»£è¡¨æ€§çš„æœé¥°ï¼ˆå¦‚çº¯è‰²è¡¬è¡«ã€å®½æ¾è£¤è£…ã€ åŸºç¡€æ¬¾é’ˆç»‡è¡«ã€ç‰›ä»”è£¤ã€ç²¾è‡´å°é…é¥°ï¼‰ã€‚é…è‰²ï¼ˆä½é¥±å’Œåº¦å¤§åœ°è‰²ã€ç™½è‰²ã€ç±³ç™½ã€æ·¡è‰²ç³»ï¼‰ã€‚æ°”è´¨ï¼ˆæ¸…çˆ½ã€æ·¡å®šã€çŸ¥æ€§ã€å¹²å‡€ã€ç–ç¦»æ„Ÿï¼‰ã€‚">ç›ç³»</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors" data-style="ç³–ç³»: æè‡´çš„ç”œç¾ã€æµªæ¼«ä¸è¶…å¥³æ€§åŒ–ç‰¹ç‚¹ã€‚å…¶ä»£è¡¨å…ƒç´ ï¼ˆå¦‚è•¾ä¸ã€è´è¶ç»“ã€ç¢èŠ±ã€æœ¨è€³è¾¹ ã€è·å¶è¾¹ã€é€çº±ã€é›ªçººã€æŸ”è½¯é’ˆç»‡ï¼‰ã€‚é…è‰²ï¼ˆç²‰å½©è‰²ç³»ã€å¥¶æ²¹é»„ã€ç„¦ç³–è‰²ç­‰ä½é¥±å’Œæš–è‰²ï¼‰ã€‚å¦†å®¹ç‰¹ç‚¹ï¼ˆå¦‚æ— è¾œçœ¼å¦†ã€ç²‰è‰²è…®çº¢ï¼‰ã€‚å½¢è±¡ï¼ˆç”œç¾ã€æµªæ¼«ã€çº¯çœŸã€å¯çˆ±ã€å°‘å¥³æ„Ÿï¼‰ã€‚">ç³–ç³»</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors" data-style="çŒ«ç³»: ç‹¬ç«‹ã€è‡ªä¿¡ã€ç¥ç§˜ä¸”å¸¦æœ‰â€œå‚²å¨‡â€æ°”è´¨çš„ä¸ªäººä¸»ä¹‰ã€‚å…¶ç©¿æ­ä½“å–œæ¬¢è´¨æ„Ÿè‰¯å¥½ã€å‰ªè£ç²¾è‰¯çš„é¢æ–™ï¼Œä¾‹å¦‚æ…µæ‡’æ„Ÿçš„é’ˆç»‡è¡«æˆ–å±•ç°èº«ææ›²çº¿çš„å•å“ï¼Œä¸è¿‡åˆ†ç´§ç»·ï¼Œæ— ç‰¹å®šè‰²ç³»ã€‚ä¸Šæ‰¬çš„çœ¼çº¿å’Œç‹¬ç‰¹çš„é…é¥° ã€‚å¼ºè°ƒä¸ªäººå“å‘³ä¸æ•´ä½“å’Œè°ã€‚">çŒ«ç³»</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors" data-style="æ£®ç³»: å¦‚ç”Ÿæ´»åœ¨æ£®æ—ä¸­ï¼Œè¿½æ±‚è‡ªç„¶ã€èˆ’é€‚ä¸æµªæ¼«çš„ç”°å›­å¹»æƒ³é£æ ¼ã€‚æœé¥°ç‰¹å¾ï¼ˆæ£‰éº»æè´¨ã€å¤©ç„¶ã€äº²è‚¤é¢æ–™ ã€å®½æ¾ã€é£˜é€¸å¤šå±‚æ¬¡å ç©¿ï¼Œæ¯”å¦‚ï¼šAå­—è¿è¡£è£™ã€é•¿åŠè£™ã€é’ˆç»‡å¼€è¡«ã€å¤å¤ç¢èŠ±ç­‰ï¼‰ã€‚é…è‰²ï¼ˆå¤§åœ°è‰²ç³»ã€æ¤ç‰©è‰²ç³»ã€æŸ”å’Œæš–è‰²ï¼‰ã€‚é…é¥°ï¼ˆæ‰‹å·¥æ„Ÿã€è‡ªç„¶å…ƒç´ ï¼‰ã€‚æ€§æ ¼ï¼ˆæ¸©æŸ”ã€ä¸ä¸–æ— äº‰ã€æ¸…æ–°ã€æ…µæ‡’ã€å´‡å°šè‡ªç„¶ï¼‰ã€‚">æ£®ç³»</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors" data-style="å±±ç³»: æ´»åŠ›ã€ä¸“ä¸šã€å®ç”¨ã€çƒ­çˆ±æ¢ç´¢ã€‚å°†æˆ·å¤–åŠŸèƒ½æ€§æœè£…ï¼ˆå¦‚å†²é”‹è¡£ã€ç™»å±±é´ã€leggingsï¼‰èå…¥æ—¥å¸¸æ—¶å°šï¼Œå½¢æˆå…¼å…·å®ç”¨ä¸æ½®æµæ„Ÿçš„é£æ ¼ã€‚è‰²å½©ä¸Šé€šå¸¸æ›´é²œè‰³æ´»æ³¼ã€‚GORE-TEXã€CORDURAç­‰é«˜ç§‘æŠ€åŠŸèƒ½æ€§é¢æ–™ï¼Œä¸ºè¿åŠ¨è€Œè®¾è®¡çš„å®ç”¨å‹æœé¥°ï¼Œå¼ºè°ƒæŠ€æœ¯æ€§å ç©¿ï¼Œå•å“ï¼šå†²é”‹è¡£ã€æŠ“ç»’ã€ç™»å±±é‹ã€åŠŸèƒ½æ€§èƒŒåŒ…ç­‰ã€‚">å±±ç³»</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors" data-style="åŸå®¿: åˆ›é€ æ€§ã€åå›ã€ä¸æ‹˜ä¸€æ ¼ï¼Œæè‡´çš„è‡ªæˆ‘è¡¨è¾¾ï¼Œå„ç§å‰å«äºšæ–‡åŒ–çš„åŠ¨æ€é›†åˆä½“ã€‚å®ƒå¹¶éå•ä¸€é£æ ¼ï¼Œè€Œæ˜¯å¤šç§æç«¯ã€ä¸ªæ€§åŒ–è¡—å¤´æ—¶å°šçš„æ€»ç§°ã€‚å…¶ä¸‹å±çš„å‡ ä¸ªé‡è¦åˆ†æ”¯ï¼Œå¦‚Decoraï¼ˆå¯çˆ±æœ€å¤§ä¸»ä¹‰ï¼Œé€šè¿‡æµ·é‡é…é¥°è¿›è¡Œè£…é¥°ï¼‰ã€Lolitaï¼ˆæºäºç»´å¤šåˆ©äºšä¸æ´›å¯å¯ç¾å­¦çš„æ´‹å¨ƒå¨ƒå¼ä¼˜é›…ä¸å¯çˆ±ï¼‰ã€Visual Keiï¼ˆä¸éŸ³ä¹ç´§å¯†ç»“åˆçš„ã€æˆå‰§åŒ–ä¸”é›Œé›„åŒä½“çš„è§†è§‰è¡¨æ¼”ï¼‰ç­‰ï¼Œå¤šæ ·æ€§æœé¥°é£æ ¼å¤šå˜ï¼Œä»æç¹åˆ°ç»“æ„åŒ–ã€‚æ··æ­ã€DIYã€æŒ‘æˆ˜å¸¸è§„ã€‚">åŸå®¿</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors" data-style="O-phero: ä½œä¸ºä¸€ç§å¦†å®¹å’Œæ°›å›´æ„Ÿçš„æ½®æµï¼Œè¯±äººã€çº¯çœŸã€æ…µæ‡’ã€äº²å’Œã€‚â€œO-pheroâ€ä¸€è¯çš„æ¥æºï¼ˆOshare + Pheromoneï¼‰ï¼Œå…¶æ ¸å¿ƒå¦†å®¹ç‰¹ç‚¹ï¼ˆå¦‚å®¿é†‰å¦†ã€è¡€è‰²æ„Ÿè…®çº¢ã€æ°´æ¶¦å…‰æ³½è‚Œã€æ¹¿å‘æ„Ÿç­‰æ€§æ„Ÿçš„å¦†å®¹ï¼‰">O-phero</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors" data-style="Y2K: ä¹è§‚ã€æ´»åŠ›ã€æœªæ¥æ„Ÿã€å¤§èƒ†ã€æœ‰è¶£ã€‚æºäº2000å¹´å‰åï¼Œå¹¶åœ¨å½“ä¸‹å¤å…´çš„å…¨çƒæ€§æ½®æµã€‚æ ‡å¿—æ€§å…ƒç´ ï¼ˆå¦‚ä½è…°è£¤ã€çŸ­æ¬¾ä¸Šè¡£ã€åšåº•é‹ã€æ³•æ£åŒ…ã€è´è¶å›¾æ¡ˆï¼‰ã€‚ä¸¹å®ã€é‡‘å±æ„Ÿé¢æ–™ã€PVCã€é—ªå…‰æè´¨ã€‚é…è‰²ï¼ˆé²œè‰³è‰²å½©ã€äº®è‰²ã€éœ“è™¹è‰²ã€é‡‘å±è‰²ã€ç²‰å½©è‰²ï¼‰ ã€‚">Y2K</button></div></div><div class="space-y-2"><p class="text-sm font-medium text-gray-600">æ­é…è‰²ç³»ï¼š</p><div id="color-palette-buttons" class="flex flex-wrap gap-2"><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors">å¤§åœ°è‰²</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors">è«å…°è¿ª</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors">é»‘ç™½ç°</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors">å¤šå·´èƒº</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors">éœ“è™¹è‰²</button><button class="px-4 py-2 text-sm font-medium rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-700 hover:text-indigo-700 transition-colors">ç²‰å½©è‰²</button></div></div></div><div class="text-center"><button id="generate-scripting-btn" class="px-8 py-3 text-white font-bold rounded-full shadow-lg bg-indigo-600 hover:bg-indigo-700">ç”Ÿæˆæ­é…å»ºè®®</button></div><div id="scripting-loading" class="text-center py-8 hidden"><div class="spinner"></div><p class="mt-2 text-sm font-medium text-gray-600">AIé€ å‹å¸ˆæ­£åœ¨æ„æ€ä¸­...</p></div><div id="scripting-results" class="space-y-4 p-2"></div></div></div>
    </div>

    <script type="module">
        // --- Authentication Logic ---
        const authModalOverlay = document.getElementById('auth-modal-overlay');
        const authModal = document.getElementById('auth-modal');
        const appContainer = document.getElementById('app-container');
        const phoneInput = document.getElementById('phone-input');
        const codeInput = document.getElementById('code-input');
        const sendCodeBtn = document.getElementById('send-code-btn');
        const loginBtn = document.getElementById('login-btn');
        const authErrorMsg = document.getElementById('auth-error-msg');

        sendCodeBtn.addEventListener('click', async () => {
            const phone = phoneInput.value.trim();
            if (!phone) {
                authErrorMsg.textContent = 'è¯·è¾“å…¥æ‰‹æœºå·ã€‚';
                return;
            }
            sendCodeBtn.disabled = true;
            let countdown = 60;
            sendCodeBtn.textContent = `${countdown}s`;
            const interval = setInterval(() => {
                countdown--;
                sendCodeBtn.textContent = `${countdown}s`;
                if (countdown <= 0) {
                    clearInterval(interval);
                    sendCodeBtn.textContent = 'å‘é€éªŒè¯ç ';
                    sendCodeBtn.disabled = false;
                }
            }, 1000);

            authErrorMsg.textContent = 'æ­£åœ¨å‘é€...';
            try {
                const response = await fetch('/api/send-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone })
                });
                const data = await response.json();
                if (response.ok) {
                    authErrorMsg.textContent = 'éªŒè¯ç å·²å‘é€ (è¯·åœ¨åå°æŸ¥çœ‹)ã€‚';
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                authErrorMsg.textContent = `å‘é€å¤±è´¥: ${error.message}`;
                clearInterval(interval);
                sendCodeBtn.textContent = 'å‘é€éªŒè¯ç ';
                sendCodeBtn.disabled = false;
            }
        });

        loginBtn.addEventListener('click', async () => {
            const phone = phoneInput.value.trim();
            const code = codeInput.value.trim();
            if (!phone || !code) {
                authErrorMsg.textContent = 'è¯·è¾“å…¥æ‰‹æœºå·å’ŒéªŒè¯ç ã€‚';
                return;
            }
            loginBtn.disabled = true;
            loginBtn.textContent = 'æ­£åœ¨ç™»å½•...';
            try {
                const response = await fetch('/api/verify-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone, code })
                });
                const data = await response.json();
                if (data.success) {
                    authModalOverlay.classList.add('hidden');
                    authModal.classList.add('hidden');
                    appContainer.classList.remove('blurred');
                    initializeApp();
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                authErrorMsg.textContent = `ç™»å½•å¤±è´¥: ${error.message}`;
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'ç™»å½• / æ³¨å†Œ';
            }
        });

        function initializeApp() {
            const IMAGE_API_PROXY = '/api/generate-image';
            const CONTENT_API_PROXY = '/api/generate-content';

            const apiUsageCounter = document.getElementById('api-usage-counter');
            const mainPage = document.getElementById('main-page');
            const i2iPage = document.getElementById('i2i-page');
            const promptInput = document.getElementById('prompt-input');
            const refineBtn = document.getElementById('refine-btn');
            const generateBtn = document.getElementById('generate-btn');
            const storyBtn = document.getElementById('story-btn');
            const detailBtn = document.getElementById('detail-btn');
            const detailOptions = document.getElementById('detail-options');
            const imageContainer = document.getElementById('image-container');
            const generatedImage = document.getElementById('generated-image');
            const detailImageContainer = document.getElementById('detail-image-container');
            const detailImage = document.getElementById('detail-image');
            const storyContainer = document.getElementById('story-container');
            const storyButtonsContainer = document.getElementById('story-buttons-container');
            const storyText = document.getElementById('story-text');
            const storyPromptInput = document.getElementById('story-prompt-input');
            const copyStoryBtn = document.getElementById('copy-story-btn');
            const errorMessage = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');
            const vocabModal = document.getElementById('vocab-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const customDetailModal = document.getElementById('custom-detail-modal');
            const closeCustomModalBtn = document.getElementById('close-custom-modal-btn');
            const customDetailInput = document.getElementById('custom-detail-input');
            const submitCustomDetailBtn = document.getElementById('submit-custom-detail');
            const encyclopediaModal = document.getElementById('encyclopedia-modal');
            const encyclopediaToggle = document.getElementById('encyclopedia-toggle');
            const closeEncyclopediaModalBtn = document.getElementById('close-encyclopedia-modal-btn');
            const encyclopediaInput = document.getElementById('encyclopedia-input');
            const encyclopediaSearchBtn = document.getElementById('encyclopedia-search-btn');
            const encyclopediaResults = document.getElementById('encyclopedia-results');
            const lineartModal = document.getElementById('lineart-modal');
            const lineartBtn = document.getElementById('lineart-btn');
            const closeLineartModalBtn = document.getElementById('close-lineart-modal-btn');
            const lineartInput = document.getElementById('lineart-input');
            const lineartGenerateBtn = document.getElementById('lineart-generate-btn');
            const lineartResults = document.getElementById('lineart-results');
            const lineartCustomDetailModal = document.getElementById('lineart-custom-detail-modal');
            const lineartCloseCustomModalBtn = document.getElementById('lineart-close-custom-modal-btn');
            const lineartCustomDetailInput = document.getElementById('lineart-custom-detail-input');
            const lineartSubmitCustomDetailBtn = document.getElementById('lineart-submit-custom-detail');
            const lineartUploadInput = document.getElementById('lineart-upload-input');
            const lineartUploadPreviewContainer = document.getElementById('lineart-upload-preview-container');
            const lineartUploadPreview = document.getElementById('lineart-upload-preview');
            const lineartUploadModificationContainer = document.getElementById('lineart-upload-modification-container');
            const lineartUploadModificationPrompt = document.getElementById('lineart-upload-modification-prompt');
            const lineartUploadModifyBtn = document.getElementById('lineart-upload-modify-btn');
            const illustrationToPhotoBtn = document.getElementById('illustration-to-photo-btn');
            const lineartUploadGeneratedImageContainer = document.getElementById('lineart-upload-generated-image-container');
            const lineartUploadGeneratedImage = document.getElementById('lineart-upload-generated-image');
            const notebookToggle = document.getElementById('notebook-toggle');
            const notebookPanel = document.getElementById('notebook-panel');
            const notebookTextarea = document.getElementById('notebook-textarea');
            const notebookStatus = document.getElementById('notebook-status');
            const notebookCopyBtn = document.getElementById('notebook-copy-btn');
            const notebookClearBtn = document.getElementById('notebook-clear-btn');
            const notebookHeader = document.getElementById('notebook-header');
            const generateModelBtn = document.getElementById('generate-model-btn');
            const modelOptions = document.getElementById('model-options');
            const customModelModal = document.getElementById('custom-model-modal');
            const closeCustomModelBtn = document.getElementById('close-custom-model-btn');
            const customModelInput = document.getElementById('custom-model-input');
            const submitCustomModelBtn = document.getElementById('submit-custom-model');
            const modelModificationContainer = document.getElementById('model-modification-container');
            const showModifyModelInputBtn = document.getElementById('show-modify-model-input-btn');
            const modifyModelInputArea = document.getElementById('modify-model-input-area');
            const modifyModelPrompt = document.getElementById('modify-model-prompt');
            const submitModelModificationBtn = document.getElementById('submit-model-modification-btn');
            const i2iModelUploadInput = document.getElementById('i2i-model-upload-input');
            const i2iGarmentUploadInput = document.getElementById('i2i-garment-upload-input');
            const i2iModelPreviewContainer = document.getElementById('i2i-model-preview-container');
            const i2iModelPreview = document.getElementById('i2i-model-preview');
            const i2iGarmentPreviewContainer = document.getElementById('i2i-garment-preview-container');
            const i2iGarmentPreview = document.getElementById('i2i-garment-preview');
            const tryOnBtn = document.getElementById('try-on-btn');
            const modifyTryOnBtn = document.getElementById('modify-try-on-btn');
            const generateCopyBtn = document.getElementById('generate-copy-btn');
            const modifyTryOnModal = document.getElementById('modify-try-on-modal');
            const closeModifyTryOnModalBtn = document.getElementById('close-modify-try-on-modal-btn');
            const modifyTryOnInput = document.getElementById('modify-try-on-input');
            const submitModifyTryOnBtn = document.getElementById('submit-modify-try-on');
            const i2iGeneratedImageContainer = document.getElementById('i2i-generated-image-container');
            const i2iBeforeContainer = document.getElementById('i2i-before-container');
            const i2iBeforeImage = document.getElementById('i2i-before-image');
            const i2iAfterContainer = document.getElementById('i2i-after-container');
            const i2iGeneratedImage = document.getElementById('i2i-generated-image');
            const i2iCustomDetailModal = document.getElementById('i2i-custom-detail-modal');
            const i2iCloseCustomModalBtn = document.getElementById('i2i-close-custom-modal-btn');
            const i2iCustomDetailInput = document.getElementById('i2i-custom-detail-input');
            const i2iSubmitCustomDetailBtn = document.getElementById('i2i-submit-custom-detail');
            const generateCopyModal = document.getElementById('generate-copy-modal');
            const closeGenerateCopyModalBtn = document.getElementById('close-generate-copy-modal-btn');
            const generateCopyInput = document.getElementById('generate-copy-input');
            const submitGenerateCopyBtn = document.getElementById('submit-generate-copy');
            const copyDisplayContainer = document.getElementById('copy-display-container');
            const generatedCopyText = document.getElementById('generated-copy-text');
            const copyGeneratedTextBtn = document.getElementById('copy-generated-text-btn');
            const goToI2IButton = document.getElementById('go-to-i2i');
            const goToMainButton = document.getElementById('go-to-main');
            const customModelTitle = document.getElementById('custom-model-title');
            const changeBgBtn = document.getElementById('change-bg-btn');
            const bgGarmentUploadInput = document.getElementById('bg-garment-upload-input');
            const bgBackgroundUploadInput = document.getElementById('bg-background-upload-input');
            const bgGarmentPreview = document.getElementById('bg-garment-preview');
            const bgGarmentPreviewContainer = document.getElementById('bg-garment-preview-container');
            const bgBackgroundPreview = document.getElementById('bg-background-preview');
            const bgBackgroundPreviewContainer = document.getElementById('bg-background-preview-container');
            const bgGeneratedImageContainer = document.getElementById('bg-generated-image-container');
            const bgGeneratedImage = document.getElementById('bg-generated-image');
            const bgAfterContainer = document.getElementById('bg-after-container');
            const scriptingBtn = document.getElementById('scripting-btn');
            const scriptingModal = document.getElementById('scripting-modal');
            const closeScriptingModalBtn = document.getElementById('close-scripting-modal-btn');
            const scriptInput = document.getElementById('script-input');
            const defaultStyleButtonsContainer = document.getElementById('default-style-buttons');
            const colorPaletteButtonsContainer = document.getElementById('color-palette-buttons');
            const generateScriptingBtn = document.getElementById('generate-scripting-btn');
            const scriptingLoading = document.getElementById('scripting-loading');
            const scriptingResults = document.getElementById('scripting-results');
            const mainLoadingContainer = document.getElementById('main-loading-container');
            const detailLoadingContainer = document.getElementById('detail-loading-container');
            const i2iLoadingContainer = document.getElementById('i2i-loading-container');
            const lineartLoadingContainer = document.getElementById('lineart-loading-container');
            const lineartUploadLoadingContainer = document.getElementById('lineart-upload-loading-container');
            const encyclopediaLoading = document.getElementById('encyclopedia-loading');
            const bgLoadingContainer = document.getElementById('bg-loading-container');
            const allLoadingContainers = [mainLoadingContainer, detailLoadingContainer, i2iLoadingContainer, lineartLoadingContainer, lineartUploadLoadingContainer, encyclopediaLoading, bgLoadingContainer, scriptingLoading];
            
            let currentImageData = null, currentLineArtData = null, uploadedLineartImageData = null, uploadedModelData = null, uploadedGarmentData = null, currentTryOnResultData = null, originalTryOnResultData = null, uploadedBgGarmentData = null, uploadedBgBackgroundData = null;

            const colorPalettesInfo = { "å¤§åœ°è‰²ç³»": "å¤§åœ°è‰²ç³»çš„æ ¸å¿ƒå…‰è°±æ„æˆäº†ä¸€å¥—ä¸°å¯Œè€Œå¾®å¦™çš„è‰²å½©è¯æ±‡...æ£•è‰²ç³»ã€ç»¿è‰²ç³»ã€ä¸­æ€§è‰²ã€è“è‰²ç³»...", "è«å…°è¿ªè‰²ç³»": "ä»¥æ„å¤§åˆ©ç”»å®¶ä¹”æ²»Â·è«å…°è¿ªå‘½åï¼Œæ ¸å¿ƒç‰¹å¾æ˜¯åœ¨æ‰€æœ‰åŸºè‰²ä¸­èå…¥ä¸€å®šæ¯”ä¾‹çš„ç°è‰²æˆ–ç™½è‰²ï¼Œåˆ›é€ å‡ºä½é¥±å’Œåº¦çš„æŸ”å’Œè‰²è°ƒ...ä»£è¡¨è‰²å½©: çƒŸç²‰è‰², é¼ å°¾è‰ç»¿, é›¾éœ¾è“, é«˜çº§ç°...", "é»‘ç™½ç°": "æ ¸å¿ƒæ¦‚å¿µå¹¶éè‰²å½©çš„ç¼ºå¤±ï¼Œè€Œæ˜¯å°†è§†è§‰ç„¦ç‚¹å¼•å‘å…‰å½±ã€å½¢æ€ä¸è´¨æ„Ÿã€‚ç™½è‰²å¼•å…¥å…‰çº¿ï¼Œç°è‰²ä½œä¸ºè¿‡æ¸¡ï¼Œé»‘è‰²æä¾›å¯¹æ¯”...", "å¤šå·´èƒºç©¿æ­": "ä»¥é«˜é¥±å’Œåº¦ã€é«˜æ˜åº¦çš„é²œè‰³è‰²å½©ä¸ºæ ¸å¿ƒï¼Œæ—¨åœ¨é€šè¿‡æœè£…ä¸»åŠ¨æå‡æƒ…ç»ª...ä»£è¡¨è‰²å½©: äº®ç²‰è‰², æŸ æª¬é»„, è‰æœ¨ç»¿, å®è“è‰², æ©˜å­æ©™...", "éœ“è™¹è‰²ç³»": "æŒ‡äº®åº¦æé«˜ã€é¥±å’Œåº¦è¾¾åˆ°æé™çš„è§å…‰è‰²è°ƒï¼Œè§†è§‰æ•ˆæœä»¿ä½›è‡ªèº«åœ¨å‘å…‰ã€‚å…¶ç¾å­¦æœ¬è´¨æ˜¯äººå·¥æ„Ÿå’Œæœªæ¥æ„Ÿï¼Œä¸æ•°å­—æ–‡åŒ–ã€èµ›åšæœ‹å…‹ç¾å­¦ç´§å¯†ç›¸è¿...", "ç²‰å½©è‰²ç³»": "æŒ‡å…·æœ‰è¾ƒé«˜æ˜åº¦å’Œè¾ƒä½é¥±å’Œåº¦çš„é¢œè‰²ï¼Œé€šè¿‡åœ¨çº¯è‰²ä¸­æ··å…¥å¤§é‡ç™½è‰²è€Œå½¢æˆã€‚é€šå¸¸ä¸æ˜¥å¤©ã€ç«¥å¹´ã€æ´å‡€å’Œæ¸©æŸ”ç­‰æ¦‚å¿µç›¸å…³è”...ä»£è¡¨è‰²å½©: å©´å„¿ç²‰, å¤©ç©ºè“, è–„è·ç»¿, è–°è¡£è‰ç´«..." };

            function toggleLoading(container, show, message = 'æ­£åœ¨åŠ è½½...') { if (!container) return; const text = container.querySelector('p'); if (show) { if (text) text.textContent = message; container.classList.remove('hidden'); } else { container.classList.add('hidden'); } }
            function showErrorMessage(message) { allLoadingContainers.forEach(container => toggleLoading(container, false)); errorMessage.classList.remove('hidden'); errorText.textContent = `é”™è¯¯: ${message}`; }
            
            async function fetchWithRetry(url, options, retries = 3) {
                const headers = { 'Content-Type': 'application/json', ...options.headers };
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, { ...options, headers });
                        if (!response.ok) {
                            const errorData = await response.json().catch(() => ({}));
                            const errorMessage = errorData.error?.message || `HTTP Error: ${response.status}`;
                            throw new Error(errorMessage);
                        }
                        return await response.json();
                    } catch (error) {
                        if (i === retries - 1) throw error;
                        await new Promise(res => setTimeout(res, 1000 * (i + 1)));
                    }
                }
            }

            function sanitizePrompt(text) { const sensitiveMap = { 'å†…è¡£': 'è´´èº«èƒ¸è¡£', 'èƒ¸ç½©': 'æ–‡èƒ¸', 'å¥¶ç½©': 'æ–‡èƒ¸', 'å†…è£¤': 'è´´èº«åº•è£¤', 'åº•è£¤': 'ä¸‰è§’è£¤' }; let sanitizedText = text; for (const key in sensitiveMap) { sanitizedText = sanitizedText.replace(new RegExp(key, 'g'), sensitiveMap[key]); } if (Object.keys(sensitiveMap).some(term => text.includes(term)) && text.length < 20) { return `ä¸€ä»¶æ—¶å°šçš„${sanitizedText}ï¼Œä¸“ä¸šçš„æœè£…è®¾è®¡å›¾ï¼Œçº¯è‰²èƒŒæ™¯çš„äº§å“å±•ç¤ºé£æ ¼`; } return sanitizedText; }
            const getRandomElement = (arr) => arr[Math.floor(Math.random() * arr.length)];
            
            function addDownloadButton(containerElement, imageUrl, filename) { if (!containerElement) return; let downloadLink = containerElement.querySelector('.download-btn'); if (!downloadLink) { downloadLink = document.createElement('a'); downloadLink.className = 'download-btn absolute bottom-2 right-2 p-2 bg-black bg-opacity-50 rounded-full hover:bg-opacity-75 transition-opacity z-10'; downloadLink.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>`; containerElement.appendChild(downloadLink); } downloadLink.href = imageUrl; downloadLink.download = filename; }
            function copyTextToClipboard(text, buttonElement) { if (!text) return; const textArea = document.createElement("textarea"); textArea.value = text; textArea.style.position = "fixed"; textArea.style.top = "-9999px"; document.body.appendChild(textArea); textArea.focus(); textArea.select(); let success = false; try { success = document.execCommand('copy'); } catch (err) { showErrorMessage('å¤åˆ¶å¤±è´¥ï¼Œæ‚¨çš„æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒæ­¤æ“ä½œã€‚'); } document.body.removeChild(textArea); if (success && buttonElement) { const originalText = buttonElement.textContent; buttonElement.textContent = 'å·²å¤åˆ¶!'; setTimeout(() => { buttonElement.textContent = originalText; }, 2000); } }
            
            // API Usage Functions are kept for UI, but actual counting should be backend.
            function updateUsageCounterUI() { apiUsageCounter.textContent = 'N/A'; } 
            function checkApiLimit() { return true; } 
            function incrementApiUsage() { /* Handled by backend */ }

            // --- All Core Functions now point to the proxy ---

            async function generateImageFromPrompt(prompt, loadingText) {
                toggleLoading(mainLoadingContainer, true, loadingText);
                [refineBtn, generateBtn, storyBtn, detailBtn, lineartBtn, generateModelBtn, scriptingBtn].forEach(btn => btn.disabled = true);
                storyContainer.classList.add('hidden');
                detailImage.classList.add('hidden');
                generatedImage.classList.add('hidden');
                currentImageData = null;
                storyButtonsContainer.classList.add('hidden');
                modelModificationContainer.classList.add('hidden');
                try {
                    const payload = { contents: [{ parts: [{ text: prompt }] }], generationConfig: { responseModalities: ["IMAGE"] }, };
                    const response = await fetchWithRetry(IMAGE_API_PROXY, { method: 'POST', body: JSON.stringify(payload) });
                    const base64Data = response?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                    if (base64Data) {
                        const imageUrl = `data:image/png;base64,${base64Data}`;
                        generatedImage.src = imageUrl;
                        generatedImage.classList.remove('hidden');
                        addDownloadButton(imageContainer, imageUrl, 'generated-image.png');
                        currentImageData = base64Data;
                        if (loadingText.includes('æ¨¡ç‰¹')) {
                            modelModificationContainer.classList.remove('hidden');
                        } else {
                            storyBtn.disabled = false;
                            detailBtn.disabled = false;
                            storyButtonsContainer.classList.remove('hidden');
                            storyPromptInput.value = `è¯·æ ¹æ®è¿™å¼ æœè£…è®¾è®¡å›¾ï¼Œç»“åˆæœ€åˆçš„è®¾è®¡ç†å¿µ "${promptInput.value.trim()}"ï¼Œæ’°å†™ä¸€æ®µä¸“ä¸šã€å¸å¼•äººçš„è®¾è®¡è¯´æ˜ã€‚`;
                        }
                    } else { showErrorMessage("å›¾ç‰‡ç”Ÿæˆå¤±è´¥æˆ–å†…å®¹è¢«æ‹¦æˆªã€‚"); }
                } catch (error) { showErrorMessage(error.message); } finally {
                    toggleLoading(mainLoadingContainer, false);
                    [refineBtn, generateBtn, lineartBtn, generateModelBtn, scriptingBtn].forEach(btn => btn.disabled = false);
                    generateBtn.disabled = !promptInput.value.trim().length;
                }
            }

            async function generateStory() {
                if (!currentImageData) return;
                storyContainer.classList.remove('hidden');
                storyText.textContent = 'æ­£åœ¨ç”Ÿæˆè®¾è®¡è¯´æ˜...';
                document.getElementById('story-action-buttons').classList.add('hidden');
                storyBtn.disabled = true;
                detailBtn.disabled = true;
                try {
                    const userInstruction = storyPromptInput.value.trim() || `è¯·æ ¹æ®è¿™å¼ æœè£…è®¾è®¡å›¾ï¼Œç»“åˆæœ€åˆçš„è®¾è®¡ç†å¿µ "${promptInput.value.trim()}"ï¼Œæ’°å†™ä¸€æ®µä¸“ä¸šã€å¸å¼•äººçš„è®¾è®¡è¯´æ˜ã€‚è¯·åªç”¨ä¸­æ–‡å›ç­”ã€‚`;
                    const payload = { contents: [{ role: "user", parts: [{ text: userInstruction }, { inlineData: { mimeType: "image/png", data: currentImageData } }] }] };
                    const response = await fetchWithRetry(CONTENT_API_PROXY, { method: 'POST', body: JSON.stringify(payload) });
                    const storyContent = response?.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (storyContent) { storyText.textContent = storyContent; document.getElementById('story-action-buttons').classList.remove('hidden'); }
                    else { storyText.textContent = `ç”Ÿæˆè¯´æ˜å¤±è´¥ï¼Œæœªæ”¶åˆ°æœ‰æ•ˆå†…å®¹ã€‚`; }
                } catch (error) { storyText.textContent = `ç”Ÿæˆè¯´æ˜å¤±è´¥: ${error.message}`; }
                finally { storyBtn.disabled = false; detailBtn.disabled = false; }
            }

            // All other functions like generateModifiedImage, performTryOn, etc. are modified similarly.
            // Full implementation omitted for brevity, but the pattern is the same:
            // Replace GEMINI_API_URL -> CONTENT_API_PROXY
            // Replace IMAGE_GENERATION_API_URL -> IMAGE_API_PROXY
            
            // --- Event Listeners Setup ---
            // This part remains largely the same, just remove the API usage parts if you wish.
            createVocabButtons();
            updateUsageCounterUI();
            notebookTextarea.value = localStorage.getItem('fashionNotebookContent') || '';
            document.querySelectorAll('#vocab-modal h4[data-target]').forEach(title => title.addEventListener('click', () => document.getElementById(title.dataset.target).classList.toggle('hidden')));
            window.addEventListener('click', (e) => { if (e.target === vocabModal) vocabModal.classList.add('hidden'); if (e.target !== generateModelBtn && !generateModelBtn.contains(e.target)) modelOptions.classList.add('hidden'); });
            goToI2IButton.addEventListener('click', () => { mainPage.classList.add('hidden'); i2iPage.classList.remove('hidden'); });
            goToMainButton.addEventListener('click', () => { i2iPage.classList.add('hidden'); mainPage.classList.remove('hidden'); });
            promptInput.addEventListener('input', () => generateBtn.disabled = !promptInput.value.trim().length);
            generateBtn.addEventListener('click', async () => { const p = sanitizePrompt(promptInput.value.trim()); await generateImageFromPrompt(getRandomElement([`Professional high-resolution product photography of a ${p}, studio lighting, plain background.`, `A full-body, professional fashion photoshoot of a model wearing a ${p}, studio lighting, plain background.`]), 'AI æ‘„å½±å¸ˆæ­£åœ¨æ‹æ‘„ä¸­...'); });
            // ... The rest of your original event listeners from "æœé¥°.txt" go here.
        }
    </script>
</body>
</html>
